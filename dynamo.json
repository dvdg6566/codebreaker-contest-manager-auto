{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Description": "Creates all dynamo DB databases and Global Secondary Indexes for Codebreaker",
	"Parameters": {
		"JudgeName": {
		  "Description": "Insert name of Codebreaker Clone",
		  "Type": "String",
		  "Default": "CodebreakerClone"
		}
	},
	"Resources":{
		"announcementsTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-announcements"]]},
				"AttributeDefinitions": [
		  		{ "AttributeName": "announceId", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "announceId", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		},
		"clarificationsTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-clarifications"]]},
				"AttributeDefinitions": [
				  {"AttributeName": "clarificationId", "AttributeType": "N" },
				  {"AttributeName": "askedBy", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "clarificationId", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST",
				"GlobalSecondaryIndexes":[{
					"IndexName": "askedByIndex",
					"KeySchema": [
						{ "AttributeName": "askedBy", "KeyType": "HASH" }
					],
					"Projection": {
		            "ProjectionType": "ALL"
		          }
				}]
			}
		},
		"contestGroupsTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-contest-groups"]]},
				"AttributeDefinitions": [
				  { "AttributeName": "groupId", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "groupId", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		},
		"contestsTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-contests"]]},
				"AttributeDefinitions": [
					{"AttributeName": "contestId", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "contestId", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		},
		"endContestTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-endcontest"]]},
				"AttributeDefinitions": [
					{"AttributeName": "eventId", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "eventId", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		},
		"miscTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-misc"]]},
				"AttributeDefinitions": [
					{"AttributeName": "category", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "category", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		},
		"problemsTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-problems"]]},
				"AttributeDefinitions": [
					{"AttributeName": "problemName", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "problemName", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		},
		"submissionsTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-submissions"]]},
				"AttributeDefinitions": [
					{"AttributeName": "subId", "AttributeType": "N" },
					{"AttributeName": "problemName", "AttributeType": "S" },
					{"AttributeName": "username", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "subId", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST",
				"GlobalSecondaryIndexes":[{
					"IndexName": "problemIndex",
					"KeySchema": [
						{ "AttributeName": "problemName", "KeyType": "HASH" },
						{ "AttributeName": "subId", "KeyType": "RANGE" }
					],
					"Projection": {
			           	"ProjectionType": "INCLUDE",
			            "NonKeyAttributes":["submissionTime", "maxTime", "score", "username", "maxMemory", "subtaskScores", "totalScore", "language", "compileErrorMessage"]
		          	}
				},{
					"IndexName": "usernameIndex",
					"KeySchema": [
						{ "AttributeName": "username", "KeyType": "HASH" },
						{ "AttributeName": "subId", "KeyType": "RANGE" }
					],
					"Projection": {
			           	"ProjectionType": "INCLUDE",
			            "NonKeyAttributes":["maxTime", "maxMemory", "totalScore", "submissionTime", "problemName", "language", "compileErrorMessage"]
			        }
				}]
			}
		},
		"usersTable":{
			"Type": "AWS::DynamoDB::Table",
			"Properties": {
				"TableName": {"Fn::Join": [ "", [{"Ref": "JudgeName"},"-users"]]},
				"AttributeDefinitions": [
				  { "AttributeName": "email", "AttributeType": "S" }
				],
				"KeySchema": [
					{ "AttributeName": "email", "KeyType": "HASH" }
				],
				"BillingMode": "PAY_PER_REQUEST"
			}
		}
	},
	"Outputs":{
		"Hi": {
			"Value": "Test"
		}
	}
}